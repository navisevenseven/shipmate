# ShipMate — Docker Compose
#
# Usage:
#   1. Copy .env.example to .env and fill in required values (4 vars)
#   2. docker compose up -d
#   3. Add bot to your chat group
#
# For sandbox-only mode (OpenClaw runs on host, sandbox in container):
#   docker compose up sandbox

services:
  # ── Full ShipMate (OpenClaw + skills + plugin + tools) ─────
  shipmate:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: shipmate
    restart: unless-stopped
    volumes:
      - ${SHIPMATE_WORKSPACE:-.}:/workspace:rw
    env_file:
      - .env
    environment:
      - OPENCLAW_WORKSPACE=/workspace
    ports:
      - "${SHIPMATE_PORT:-3177}:${OPENCLAW_GATEWAY_PORT:-18789}"
    healthcheck:
      test: ["CMD", "curl", "-sf", "http://localhost:${OPENCLAW_GATEWAY_PORT:-18789}/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # ── Sandbox only (for OpenClaw sandbox mode) ───────────────
  # Use this when OpenClaw runs on the host and you only need
  # an isolated container for bash command execution.
  sandbox:
    build:
      context: .
      dockerfile: Dockerfile.sandbox
    container_name: shipmate-sandbox
    volumes:
      - ${SHIPMATE_WORKSPACE:-.}:/workspace:rw
      - ${SHIPMATE_KUBE_CONFIG:-/dev/null}:/home/shipmate/.kube/config:ro
    env_file:
      - .env
    stdin_open: true
    tty: true
    profiles:
      - sandbox
