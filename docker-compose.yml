# ShipMate — Docker Compose for local dog-fooding
#
# Usage:
#   1. Copy .env.example to .env and fill in your tokens
#   2. Set SHIPMATE_WORKSPACE to your target project path
#   3. docker compose up
#
# For sandbox-only mode (OpenClaw runs on host, sandbox in container):
#   docker compose up sandbox

services:
  # ── Full ShipMate (OpenClaw + skills + plugin + tools) ─────
  shipmate:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: shipmate
    restart: unless-stopped
    volumes:
      - ${SHIPMATE_WORKSPACE:-.}:/workspace:rw
    env_file:
      - .env
    environment:
      - OPENCLAW_WORKSPACE=/workspace
    ports:
      - "${SHIPMATE_PORT:-3177}:3177"
    healthcheck:
      test: ["CMD", "node", "-e", "console.log('ok')"]
      interval: 30s
      timeout: 10s
      retries: 3

  # ── Sandbox only (for OpenClaw sandbox mode) ───────────────
  # Use this when OpenClaw runs on the host and you only need
  # an isolated container for bash command execution.
  sandbox:
    build:
      context: .
      dockerfile: Dockerfile.sandbox
    container_name: shipmate-sandbox
    volumes:
      - ${SHIPMATE_WORKSPACE:-.}:/workspace:rw
    env_file:
      - .env
    # Keep container running — OpenClaw connects via docker exec
    stdin_open: true
    tty: true
    profiles:
      - sandbox
